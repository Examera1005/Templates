<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Calendar - Demo</title>
    <link rel="stylesheet" href="calendar.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .demo-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .demo-header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .demo-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .demo-controls button {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .demo-controls button:hover {
            background: #0056b3;
        }
        
        .demo-controls button.secondary {
            background: #6c757d;
        }
        
        .demo-controls button.success {
            background: #28a745;
        }
        
        .demo-controls button.danger {
            background: #dc3545;
        }
        
        .status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            background: #e9ecef;
            color: #495057;
        }
        
        .auth-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin-top: 15px;
        }
        
        .auth-section h4 {
            margin: 0 0 10px 0;
            color: #495057;
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <div class="demo-header">
            <h1>Interactive Calendar Demo</h1>
            <p>This calendar can work with or without authentication. Try the different modes below.</p>
            
            <div class="demo-controls">
                <button onclick="initSimpleCalendar()">Simple Calendar (No Auth)</button>
                <button onclick="initAuthCalendar()" class="success">Calendar with Auth</button>
                <button onclick="toggleAuthMode()" class="secondary">Toggle Auth Mode</button>
                <button onclick="addSampleEvents()" class="secondary">Add Sample Events</button>
                <button onclick="clearAllEvents()" class="danger">Clear All Events</button>
            </div>
            
            <div class="auth-section">
                <h4>Authentication Demo</h4>
                <div class="demo-controls">
                    <button onclick="login('john')" class="success">Login as John</button>
                    <button onclick="login('jane')" class="success">Login as Jane</button>
                    <button onclick="logout()" class="danger">Logout</button>
                </div>
                <div id="auth-status" class="status">Not logged in</div>
            </div>
            
            <div id="calendar-status" class="status">
                Click "Simple Calendar" or "Calendar with Auth" to initialize
            </div>
        </div>
        
        <div id="calendar-container"></div>
    </div>

    <script type="module">
        import { createCalendar, CalendarConfig, AuthExamples } from './index.js';
        
        let currentCalendar = null;
        let currentUser = null;
        
        // Make functions global for button clicks
        window.initSimpleCalendar = async function() {
            if (currentCalendar) {
                currentCalendar.destroy?.();
            }
            
            document.getElementById('calendar-container').innerHTML = '';
            
            currentCalendar = await createCalendar('calendar-container', {
                useAuth: false,
                defaultView: 'month'
            });
            
            updateStatus('Simple calendar initialized (no authentication required)');
        };
        
        window.initAuthCalendar = async function() {
            if (currentCalendar) {
                currentCalendar.destroy?.();
            }
            
            document.getElementById('calendar-container').innerHTML = '';
            
            currentCalendar = await createCalendar('calendar-container', {
                useAuth: true,
                authOptions: {
                    getCurrentUser: () => currentUser,
                    onAuthRequired: () => {
                        alert('Please log in first using the demo buttons above');
                    }
                },
                defaultView: 'month'
            });
            
            updateStatus('Authentication-enabled calendar initialized');
        };
        
        window.toggleAuthMode = function() {
            CalendarConfig.useAuth = !CalendarConfig.useAuth;
            if (currentCalendar) {
                currentCalendar.refreshCalendar?.();
            }
            updateStatus(`Auth mode: ${CalendarConfig.useAuth ? 'enabled' : 'disabled'}`);
        };
        
        window.login = function(username) {
            currentUser = {
                id: username,
                name: username.charAt(0).toUpperCase() + username.slice(1),
                email: `${username}@example.com`
            };
            
            if (currentCalendar && currentCalendar.setUser) {
                currentCalendar.setUser(currentUser);
            }
            
            updateAuthStatus();
            updateStatus(`Logged in as ${currentUser.name}`);
        };
        
        window.logout = function() {
            currentUser = null;
            
            if (currentCalendar && currentCalendar.setUser) {
                currentCalendar.setUser(null);
            }
            
            updateAuthStatus();
            updateStatus('Logged out');
        };
        
        window.addSampleEvents = async function() {
            if (!currentCalendar) {
                alert('Please initialize a calendar first');
                return;
            }
            
            const today = new Date();
            const sampleEvents = [
                {
                    title: 'Team Meeting',
                    description: 'Weekly team sync',
                    date: today.toISOString().split('T')[0],
                    time: '10:00',
                    duration: 60,
                    color: '#007bff'
                },
                {
                    title: 'Lunch Break',
                    description: 'Lunch with colleagues',
                    date: today.toISOString().split('T')[0],
                    time: '12:00',
                    duration: 60,
                    color: '#28a745'
                },
                {
                    title: 'Project Deadline',
                    description: 'Submit project proposal',
                    date: new Date(today.getTime() + 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                    time: '17:00',
                    duration: 30,
                    color: '#dc3545'
                }
            ];
            
            try {
                for (const event of sampleEvents) {
                    await currentCalendar.dataManager.addEvent(event);
                }
                currentCalendar.refreshCalendar();
                updateStatus('Sample events added successfully');
            } catch (error) {
                updateStatus('Error adding sample events: ' + error.message);
            }
        };
        
        window.clearAllEvents = function() {
            if (!currentCalendar) {
                alert('Please initialize a calendar first');
                return;
            }
            
            if (confirm('Are you sure you want to clear all events?')) {
                currentCalendar.dataManager.clearEvents();
                currentCalendar.refreshCalendar();
                updateStatus('All events cleared');
            }
        };
        
        function updateStatus(message) {
            document.getElementById('calendar-status').textContent = message;
        }
        
        function updateAuthStatus() {
            const statusEl = document.getElementById('auth-status');
            if (currentUser) {
                statusEl.textContent = `Logged in as: ${currentUser.name} (${currentUser.email})`;
                statusEl.style.background = '#d4edda';
                statusEl.style.color = '#155724';
            } else {
                statusEl.textContent = 'Not logged in';
                statusEl.style.background = '#f8d7da';
                statusEl.style.color = '#721c24';
            }
        }
        
        // Initialize with simple calendar by default
        initSimpleCalendar();
    </script>
</body>
</html>